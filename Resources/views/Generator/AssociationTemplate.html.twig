
    /**
     *
     * @param QueryBuilder $qb
     * @param unknown      $value
     * @param string       $operator
     * @param string       $entityName
     * @param string       $columnName
     * @return QueryBuilder
     */
    public static function filterBy{{ column }}(QueryBuilder $qb, $value, $operator = Comparison::EQ, $entityName = '{{ entityDql }}', $columnName = '{{ columnDql }}')
    {
        //get a uniq index
        $index = static::getParameterIndex();
        $parameterName = $columnName.$index;

        unset($index);

        if ($value === null) {
            $qb->andWhere($entityName.'.'.$columnName.' IS NULL');
        } else {
            $qb->andWhere($entityName.'.'.$columnName.$operator.':'.$parameterName);
            $qb->setParameter($parameterName, $value->getId());
        }

        return $qb;
    }

    /**
     *
     * @param QueryBuilder $qb
     * @param unknown      $values
     * @param string       $entityName
     * @param string       $columnName
     * @return QueryBuilder
     */
    public static function filterIn{{ column }}(QueryBuilder $qb, $values, $entityName = '{{ entityDql }}', $columnName = '{{ columnDql }}')
    {
        //get a uniq index
        $index = static::getParameterIndex();
        $parameterName = $columnName.$index;

        unset($index);

        if ($values === null) {
            $qb->andWhere($entityName.'.'.$columnName.' IS NULL');
        } else {
            $ids = array();
            //the array might contains a null value
            $orNull = '';

            foreach ($values as $value) {
                if ($value !== null) {
                    $ids[] = $value->getId();
                } else {
                    $orNull = ' OR '.$entityName.'.'.$columnName.' IS NULL';
                }
            }

            $qb->andWhere($entityName.'.'.$columnName.' IN (:'.$parameterName.')'.$orNull);
            $qb->setParameter($parameterName, $ids);
        }

        return $qb;
    }

    /**
     *
     * @param QueryBuilder $qb
     * @param unknown      $values
     * @param string       $entityName
     * @param string       $columnName
     * @return QueryBuilder
     */
    public static function filterNotIn{{ column }}(QueryBuilder $qb, $values, $entityName = '{{ entityDql }}', $columnName = '{{ columnDql }}')
    {
        //get a uniq index
        $index = static::getParameterIndex();
        $parameterName = $columnName.$index;

        unset($index);

        if ($values === null) {
            $qb->andWhere($entityName.'.'.$columnName.' IS NOT NULL');
        } else {
            $ids = array();

            foreach ($values as $value) {
                $ids[] = $value->getId();
            }
            $qb->andWhere($entityName.'.'.$columnName.' NOT IN (:'.$parameterName.')');
            $qb->setParameter($parameterName, $ids);
        }

        return $qb;
    }
